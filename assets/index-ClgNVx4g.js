(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function C(e){if(!e)return;const n=()=>{const t=e.value.split(`
`).length||1;e.style.height=`${t+1.25}em`};e.addEventListener("input",n),e.addEventListener("focus",n),n()}class P{constructor(n,t,o,s=!1,i=!1,c=!1){this.title=n,this.notes=t,this.dueDate=o,this.priority=s,this.done=i,this.isCreator=c,this.id=crypto.randomUUID()}toJSON(){const{project:n,...t}=this;return t}}function k(e){const n=document.createElement("div");return n.id="projectHeader",n.textContent=e.name,n.style.color=e.color,n}function M(e=null){const n=e!==null,t=document.getElementById("project-menu");t&&t.remove();const o=document.createElement("div");o.id="project-menu";const s=n?"Edit Project":"New Project",i=n?e.name:"",c=n?e.color:"#000000";o.innerHTML=`
        <div class="popup">
            <h2>${s}</h2>
            <div class="popup-content">
                <label>
                    <span>Name:</span> 
                    <input type="text" id="project-name" value="${i}"/>
                </label>
                <label>
                    <span>Color:</span> 
                    <input type="color" id="project-color" value="${c}"/>
                </label>
            </div>
            <div class="popup-actions">
                <button id="cancel-project">Cancel</button>
                <button id="save-project">Save</button>
            </div>
        </div>`,document.body.append(o),document.getElementById("cancel-project").addEventListener("click",()=>{o.remove()}),document.getElementById("save-project").addEventListener("click",()=>{const a=document.getElementById("project-name").value.trim(),l=document.getElementById("project-color").value;if(a){if(n)O(e,{name:a,color:l});else{const m=U(a);O(m,{color:l})}o.remove()}})}function S(e,n){let t=e.dataset.field;if(!t)return{changed:!1,deleted:!1};let o;const s=n[t];t==="priority"&&e.tagName==="BUTTON"?o=e.getAttribute("aria-pressed")==="true":e.type==="checkbox"?o=e.checked:e.type==="date"?o=e.value?e.value:null:o=e.value.trim();let i=s!==o;return t==="title"&&s===void 0&&o===""&&(i=!1),n[t]=o,t==="title"&&o===""&&!n.notes&&!n.dueDate&&n.project&&typeof n.project.deleteTask=="function"&&n.project.tasks&&n.project.tasks.includes(n)?(n.project.deleteTask(n),n.project.id&&localStorage.setItem(`project_${n.project.id}`,JSON.stringify(n.project)),{changed:!0,deleted:!0}):(i&&n.project&&n.project.id&&(console.log("Saving project:",n.project),localStorage.setItem(`project_${n.project.id}`,JSON.stringify(n.project)),console.log(`Project ${n.project.id} saved to localStorage due to task update.`)),{changed:i,deleted:!1})}function N(e,n,t){const o=document.getElementById("context-menu");o&&o.remove(),j();const s=document.createElement("div");s.id="context-menu",s.style.position="absolute",s.style.top=n+"px",s.style.left=e+"px",s.classList.add("context-menu"),t.forEach(i=>{const c=document.createElement("div");c.textContent=i.label,c.addEventListener("click",()=>{i.action(),s.remove(),j()}),s.append(c)}),s.hasChildNodes()&&(document.body.append(s),document.addEventListener("click",V),document.addEventListener("keydown",$))}function V(e){const n=document.getElementById("context-menu");n&&!n.contains(e.target)&&(n.remove(),j())}function $(e){if(e.key==="Escape"){const n=document.getElementById("context-menu");n&&n.remove(),j()}}function j(){document.removeEventListener("click",V),document.removeEventListener("keydown",$)}function w(e,n){const t=document.createElement("div");t.className="task",t.dataset.taskId=e.id,e.isCreator&&t.classList.add("task-creator");const o=document.createElement("div");o.className="task__body";const s=document.createElement("input");s.type="checkbox",s.checked=e.done,s.dataset.field="done",e.isCreator?s.style.visibility="hidden":s.addEventListener("change",()=>{const r=S(s,e);(r.changed||r.deleted)&&(t.dataset.changedSinceFocusIn="true",y())});const i=document.createElement("input");i.type="text",i.value=e.title||"",i.placeholder="New task",i.dataset.field="title";const c=document.createElement("input");c.type="date",c.value=e.dueDate||"",c.dataset.field="dueDate";const a=document.createElement("button");a.classList.add("priority-btn"),a.dataset.field="priority",a.setAttribute("aria-pressed",e.priority?"true":"false"),a.setAttribute("title","Toggle priority");const l='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>flag-variant</title><path fill="currentColor" d="M6,3A1,1 0 0,1 7,4V4.88C8.06,4.44 9.5,4 11,4C14,4 14,6 16,6C19,6 20,4 20,4V12C20,12 19,14 16,14C13,14 13,12 11,12C8,12 7,14 7,14V21H5V4A1,1 0 0,1 6,3Z" /></svg>',m='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>flag-variant-outline</title><path fill="currentColor" d="M6,3A1,1 0 0,1 7,4V4.88C8.06,4.44 9.5,4 11,4C14,4 14,6 16,6C19,6 20,4 20,4V12C20,12 19,14 16,14C13,14 13,12 11,12C8,12 7,14 7,14V21H5V4A1,1 0 0,1 6,3M7,7.25V11.5C7,11.5 9,10 11,10C13,10 14,12 16,12C18,12 18,11 18,11V7.5C18,7.5 17,8 16,8C14,8 13,6 11,6C9,6 7,7.25 7,7.25Z" /></svg>';a.innerHTML=e.priority?l:m,e.isCreator?a.addEventListener("click",()=>{const r=a.getAttribute("aria-pressed")==="true";a.setAttribute("aria-pressed",r?"false":"true"),a.innerHTML=r?m:l}):a.addEventListener("click",()=>{const d=!(a.getAttribute("aria-pressed")==="true");a.setAttribute("aria-pressed",d?"true":"false"),a.innerHTML=d?l:m,S(a,e).changed&&(t.dataset.changedSinceFocusIn="true"),y()});const u=document.createElement("textarea");u.value=e.notes||"",u.placeholder=(e.isCreator,"Notes"),u.dataset.field="notes",C(u);const E=()=>{const r=i.value.trim();if(r!==""){const d=new P(r,u.value.trim(),c.value||null,a.getAttribute("aria-pressed")==="true",!1,!1,n);R(d,n),i.value="",u.value="",c.value="",a.setAttribute("aria-pressed","false"),a.innerHTML=m,C(u),e.isCreator||i.focus()}},v=document.createElement("header");v.classList.add("task__header");const f=document.createElement("div");return f.classList.add("task__info"),v.append(s,i,a),f.append(u,c),o.append(v,f),t.append(o),e.isCreator||[e.notes,e.dueDate].every(p=>!p||typeof p=="string"&&p.trim()==="")&&t.classList.add("collapsed"),t.addEventListener("focusin",r=>{e.isCreator||(t.classList.remove("collapsed"),C(u),t.dataset.changedSinceFocusIn="false")}),t.addEventListener("focusout",r=>{const d=r.target,p=d.dataset.field,x=r.relatedTarget;if(e.isCreator){(x===null||!t.contains(x))&&setTimeout(()=>{t.contains(document.activeElement)||E()},0);return}if(p&&p!=="done"&&p!=="priority"){const h=S(d,e);if((h.changed||h.deleted)&&(t.dataset.changedSinceFocusIn="true",h.deleted)){y();return}}setTimeout(()=>{if(!t.contains(document.activeElement)){t.dataset.changedSinceFocusIn==="true"&&y();const h=u.value.trim(),F=c.value;!h&&!F&&!t.classList.contains("collapsed")&&t.classList.add("collapsed")}},0)}),t.addEventListener("keydown",r=>{const d=r.target,p=d.dataset.field;if(p){if(e.isCreator&&p==="notes"&&r.key==="Enter"&&!r.shiftKey){r.preventDefault(),d.blur();return}if(!(p==="notes"&&r.key==="Enter"&&!r.shiftKey&&!e.isCreator)){if(r.key==="Escape"){r.preventDefault(),d.blur();return}if(r.key==="Enter"){if(!e.isCreator&&p==="notes")return;r.preventDefault(),d.blur()}}}}),t.addEventListener("contextmenu",r=>{r.preventDefault(),r.stopPropagation();const d=[{label:"Delete",action:()=>{e.project.deleteTask(e)}}];N(r.pageX,r.pageY,d)}),t}function A(e){const n=new P("","",null,null,!1,!0),t=w(n,e);return t.classList.add("task","task-creator"),t}function _(){const e=document.createElement("div");e.id="taskSection";let n=L(),t=k(n||{name:"Loading project..."});e.append(t);const o=document.createElement("div");o.id="taskList",e.append(o);let s=A(n||{name:"Loading project...",tasks:[]});e.append(s);function i(){const c=L();if(!c){if(t){const f=k({name:"No project selected"});t.parentNode&&t.parentNode.replaceChild(f,t),t=f}o.innerHTML="",s&&(s.style.display="none"),n=null;return}if(!n||c.id!==n.id){const f=k(c);t.parentNode&&t.parentNode.replaceChild(f,t),t=f;const r=A(c);s.parentNode&&s.parentNode.replaceChild(r,s),s=r,n=c}s&&(s.style.display="");let a=document.activeElement,l=null,m=null,u=null,E=null;const v=a&&typeof a.closest=="function"?a.closest(".task[data-task-id]"):null;if(v&&o.contains(v)&&(l=v.dataset.taskId,m=a.dataset.field,a&&typeof a.selectionStart=="number"&&(u=a.selectionStart,E=a.selectionEnd)),o.innerHTML="",c.tasks&&c.tasks.forEach(f=>{o.appendChild(w(f,c))}),l&&m){const f=o.querySelector(`.task[data-task-id="${l}"]`);if(f){const r=f.querySelector(`[data-field="${m}"]`);if(r&&typeof r.focus=="function"&&(r.focus(),u!==null&&typeof r.setSelectionRange=="function"))try{r.setSelectionRange(u,E)}catch{}}}}return i(),window.addEventListener("activeProjectChanged",i),window.addEventListener("tasksChanged",i),e}class b{constructor(n,t=!1){this.name=n,this.id=crypto.randomUUID(),this.tasks=[],this.color="#000000",this.archived=!1,this.isDefault=t}addTask(n){n.project=this,this.tasks.push(n),localStorage.setItem(`project_${this.id}`,JSON.stringify(this)),y()}deleteTask(n){this.tasks=this.tasks.filter(t=>t.id!==n.id),localStorage.setItem(`project_${this.id}`,JSON.stringify(this)),y()}showProjectTasks(){const n=document.createElement("div");return n.id="taskList",n.addEventListener("contextmenu",t=>{const o=t.target.closest(".task");if(!o)return;t.preventDefault();const s=o.dataset.taskId,i=this.tasks.find(l=>l.id===s);if(!i)return;const c=[],a=this.tasks[this.tasks.length-1];i!==a&&c.push({label:"Delete Task",action:()=>{this.deleteTask(i),o.remove()}}),N(t.pageX,t.pageY,c)}),this.tasks.forEach(t=>{let o=w(t);n.append(o)}),n}render(){const n=document.getElementById("taskList");n&&this.tasks.forEach(t=>{const o=n.querySelector(`[data-task-id="${t.id}"]`);if(o){const s=o.querySelector('input[data-field="title"]'),i=o.querySelector('textarea[data-field="notes"]');s&&(s.value=t.title||""),i&&(i.value=t.notes||"")}else{const s=w(t);n.append(s)}})}}let B;function J(e,n){return Array.isArray(e)?e.map(t=>{const o=new P(t.title,t.notes,t.dueDate,t.priority);return Object.assign(o,t),o.project=n,o}):[]}function q(){let e=[];if(typeof localStorage>"u")return console.warn("localStorage is not available. Cannot load projects."),e;for(let n=0;n<localStorage.length;n++){let t=localStorage.key(n);if(t.startsWith("project_")){let o=localStorage.getItem(t);if(o)try{const s=JSON.parse(o);if(s&&typeof s=="object"&&s.id&&s.name){const i=new b(s.name,s.isDefault);Object.assign(i,s),i.tasks=J(s.tasks??[],i),e.push(i)}else console.warn(`Data for key "${t}" was parsed but does not look like a valid project:`,s)}catch(s){console.error(`Error parsing JSON for key "${t}":`,s,`
Value was:`,o)}else console.warn(`No value found for project key "${t}", though key exists.`)}}return e}let g=q();function R(e,n=null){(!n||n.id==="system-all"?K():n).addTask(e)}function y(){window.dispatchEvent(new CustomEvent("tasksChanged"))}function D(){window.dispatchEvent(new CustomEvent("projectsChanged"))}function T(e){B=e,window.dispatchEvent(new CustomEvent("activeProjectChanged"))}function L(){return B}function H(e){g.push(e),localStorage.setItem(`project_${e.id}`,JSON.stringify(e)),D()}function U(e){if(["All","Today","Scheduled","Inbox"].some(o=>o.toLowerCase()===e.toLowerCase()))return alert(`"${e}" is a reserved name and cannot be used. Please choose a different name.`),null;const t=new b(e,!1);return H(t),t}function I(){return[{name:"All",get tasks(){return g.flatMap(n=>n.tasks)},id:"system-all",isDefault:!0,color:"#fffffff",showProjectTasks:b.prototype.showProjectTasks,render:function(){const n=document.getElementById("taskList");if(n){const t=this.showProjectTasks();n.parentNode.replaceChild(t,n)}}},...g]}function G(e){if(!e||typeof e.id>"u"){console.error("deleteProject: Invalid project object or project.id is missing.",e);return}if(["system-all","system-today","system-scheduled","system-inbox"].includes(e.id)){console.log("Cannot delete system project");return}else g=g.filter(t=>t.id!==e.id),localStorage.removeItem(`project_${e.id}`),D()}function O(e,n){Object.assign(e,n),localStorage.setItem(`project_${e.id}`,JSON.stringify(e)),D(),y()}function K(){return g.find(e=>e.id==="system-inbox")}const X=[{name:"Today",id:"system-today",isDefault:!0},{name:"Scheduled",id:"system-scheduled",isDefault:!0},{name:"Inbox",id:"system-inbox",isDefault:!0}];X.forEach(e=>{let n=g.find(t=>t.id===e.id);if(!n){const t=new b(e.name,e.isDefault);t.id=e.id,H(t),n=t}e.id==="system-today"&&T(n)});function Y(){const e=document.createElement("div");e.id="projects-container",e.classList.add("view-grid"),e.addEventListener("contextmenu",t=>{const o=t.target.closest(".project-tile");if(!o)return;t.preventDefault(),o.dataset.projectName;const s=o.dataset.projectId,i=I().find(a=>a.id===s);if(!i)return;const c=[];c.push({label:`Edit "${i.name}"`,action:()=>{M(i)}}),i.isDefault||c.push({label:`Delete "${i.name}"`,action:()=>{if(L()===i){const a=I().find(l=>l.id==="system-today");a&&T(a)}G(i)}}),N(t.pageX,t.pageY,c)});function n(){e.innerHTML="";const t=L();I().filter(o=>!o.isHiddenInSidebar).forEach(o=>{let s=document.createElement("div");s.classList.add("project-tile"),s.textContent=o.name,s.dataset.projectName=o.name,s.dataset.projectId=o.id,s.style.color=o.color,t&&o.id===t.id&&s.classList.add("active"),s.addEventListener("click",()=>{T(o)}),e.append(s)})}return window.addEventListener("projectsChanged",n),window.addEventListener("activeProjectChanged",n),n(),e}function z(){const e=document.createElement("div");e.id="sidebar";const n=document.createElement("div");n.classList.add("view-controls");const t=document.createElement("button");t.id="grid-view-btn",t.classList.add("view-btn","active"),t.innerHTML="▦",t.setAttribute("aria-label","Grid View");const o=document.createElement("button");o.id="list-view-btn",o.classList.add("view-btn"),o.innerHTML="≡",o.setAttribute("aria-label","List View"),n.append(t,o);const s=document.createElement("button");s.id="create-project-btn",s.textContent="New Project",s.addEventListener("click",()=>{M()}),e.append(n),e.append(Y()),e.append(s);const i=e.querySelector("#projects-container");return t.addEventListener("click",()=>{i.classList.contains("view-grid")||(i.classList.remove("view-list"),i.classList.add("view-grid"),o.classList.remove("active"),t.classList.add("active"))}),o.addEventListener("click",()=>{i.classList.contains("view-list")||(i.classList.remove("view-grid"),i.classList.add("view-list"),t.classList.remove("active"),o.classList.add("active"))}),e}console.log("we're live");function Z(){const e=document.getElementById("app");e.innerHTML="",e.append(z(),_())}Z();
